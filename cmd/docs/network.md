# 协议栈
## 链接层(mac层)
负责在以太网、WiFi这样的底层网络发送原始数据包，工作在网卡的层次，使用MAC地址标记网络设备，所以也叫MAC层

## 网际层(网络互联层)
IP协议就在这一层，IP协议定义了IP地址的概念，所以就可以在链接层的基础上使用IP地址代替MAC地址。IP地址可以把许许多多的设备链接到一个大的局域网，在网络里面寻找设备只需要把IP地址再翻译成MAC地址即可

## 传输层
这个层次协议负责保证数据在两个IP节点之间可靠传输，是TCP、UDP协议工作的层次
TCP为有状态协议，需要先建立连接再发送数据保证数据不重复不丢失。而UDP则比较简单，它是无状态的，不用事先建立连接可以任意发送数据，但不保证数据一定会发送到对方。两个协议的另一个重要的区别在于数据形式上。TCP的数据是连续的'字节流'，有先后顺序。UDP是分散的数据包，发送有序，接受乱序

## 应用层
Telnet、SSH、FTP、SMTP等等

# OSI模型

## 物理层
网络的物理形式，电缆、光缆、网卡、集线器等

## 数据链路层 
类似TCP/IP中的链接层, 数据叫做数据帧. 识别mac地址

## 网络层
类似TCP/IP中的网际层, 数据叫做数据包或报文分组. 识别ip地址

## 传输层
类似TCP/IP中的传输层, 数据叫做数据段或报文(发送的时候把报文拆成报文分组,接受的时候组装报文分组)

## 会话层
维护网络连接状态，即保持会话和同步

## 表示层
把数据转化为合适、可理解的语法和语义

## 应用层
面向具体的应用传输数据

# 四层负载均衡 七层负载均衡

## 负载均衡
1. 二层负载均衡 虚拟mac地址接受请求，再转发到真实mac地址
2. 三层负载均衡 虚拟ip地址接受请求, 再转发到真实ip地址
3. 四层负载均衡 虚拟ip+端口接受请求, 再转发到真实服务器地址
4. 七层负载均衡 虚拟URL或主机名接受请求, 再转发到真实服务器地址 (建立在四层之上)
## 四层负载均衡
ip+端口找到真实主机(通过mac地址或者相关算法)

## 七层负载均衡
利用URL等协议实现


## TCP
### 什么是协议栈
是一种特定的沟通的模式

### TCP如何保证包的顺序性
### TCP的拥塞控制
### 网断了,TCP怎么处理
### TCP的粘包与分包

> 网卡是将数字型号转换为光电信号

### 查看端口占用
- netstat
```
-t (tcp) 仅显示tcp相关选项
-u (udp)仅显示udp相关选项
-n 拒绝显示别名，能显示数字的全部转化为数字
-l 仅列出在Listen(监听)的服务状态
-p 显示建立相关链接的程序名
```

### 创建网络命名空间
```
ip netns add eden //创建命名空间
ip netns exec eden bash //进入网络命名空间
ip netns exec eden bash -rcfile <(echo "PS1=\"eden>\"")
```

### ip命令
#### 两个命名空间通讯
```
ip link //查看链路层信息
ip link set lo(device) down //关闭指定接口
// 连接两个netns
ip link add xi type veth peer name pan // 为两个ns创建共享工具
ip link set xi netns xi //把共享工具的一边搭建到xi的netns
ip link set pan netns pan //把共享工具的另一边搭建到pan的netns
ip netns exec xi ip addr add dev xi 192.168.188.96/24 //固定范围
ip netns exec pan ip addr add dev pan 192.168.188.96/24 //固定范围
ip netns exec xi ip link set xi up //启用接口
ip netns exec pan ip link set pan up //启用接口
```

#### 多个命名空间通讯
```
ip link add wangpo type bridge // 搭建桥
ip link add wp2xmq type veth peer name xmq2wp // 在桥上搭建梯子
ip link set xmq2wp netns xi // xi到wang的梯子放到xi的netns
ip link set wp2xmq master wangpo
ip netns exec xi ip addr add dev xi 192.168.188.96/24 //固定范围
ip netns exec xi ip link set xi up //启用接口
ip link set wp2xmq up // 启用接口
...
```

## 网络设备
### hub(集线器)
集线器工作在物理设备上(广播)

### Network bridge
网桥工作在数据链接层(通过mac地址寻址),不会进行广播。端口映射了多个mac地址,并未解决完全的广播风暴(学习过程中优化).

### Switch(交换机)
交换机工作在L2(数据链接层),一个网口对应一个mac地址.完全解决了广播风暴

### DHCP Server 
动态主机配置协议, 给客户机动态分配IP、网关、DNS

### NAT Device
工作在L3(网络层)



## 概念
### 泛洪
泛洪mac地址
### 广播
广播的是mac地址
- 全网段广播地址: 255.255.255.255
- 单网段广播地址: 192.168.28.255


## TCP/IP协议簇组成

应用层          HTTP、FTP、TFTP(简单文件传输协议)、SMTP(简单邮件传输协议)、SNMP(简单网络管理协议,用于服务器监控)、DNS
------------------------------------------------------------------------------------------
传输层          TCP、UDP
------------------------------------------------------------------------------------------
网络层          ICMP(互联网控制消息协议,做网络探测的)、IGMP(互联网组管理协议)、IP(网际协议)、ARP(地址解析协议,IP到MAC解析)、RARP(反向地址解析协议,MAC到IP解析)
------------------------------------------------------------------------------------------
数据链路层       PPP、PPPOE
物理层

## 防火墙
数据包过滤(IP地址、MAC地址、协议、端口、数据包中的数据)

## IP协议
数据包最大65535(2的16次方), IP协议包头包字节数为20字节
### IP分类
#### A类 二进制位以0开头
A类只有127.0.0.1可用
00000001.00000000.00000000.00000000 (1.0.0.0)
01111111.11111111.11111111.11111111 (127.255.255.255)

#### B类  二进制位以10开头 
10000000.00000000.00000000.00000000 (128.0.0.0)
10111111.11111111.11111111.11111111 (191.255.255.255)

#### C类 二进制位以110开头
11000000.00000000.00000000.00000000 (192.0.0.0)
11011111.11111111.11111111.11111111 (223.255.255.255)

#### D类 二进制位以1110开头(组播IP)
路由地址分为静态IP、动态IP, 组播IP用来路由做动态学习用的
11100000.00000000.00000000.00000000 (224.0.0.0)
11101111.11111111.11111111.11111111 (239.255.255.255) 

#### E类 二进制位以1111开头(保留)
11110000.00000000.00000000.00000000 (240.0.0.0)
11111111.11111111.11111111.11111111 (255.255.255.255 全网段广播) 

### 私有IP
- 10.0.0.0 ~ 10.255.255.255 (A类拿出了所有网段)
- 172.16.0.0 ~ 172.31.255.255 (B类拿出了16个子网段)
- 192.168.0.0 ~ 192.168.255.255 (C类拿出了0~255子网段)
### 网络地址和主机地址
A类：前7位代表网络, 后24位代表主机
子网数: 2^7 - 2 = 126
主机数: 2^24 - 2

B类: 前14位代表网络, 后16代表主机
子网数: 2^14 - 2
主机数: 2^16 - 2

C类:
子网数: 2^21 - 2
主机数: 2^8 - 2

### 默认子网掩码
用来标识那些是网络地址,那些事主机地址。255对应的是网络地址,0对应的是主机地址
A类: 255.0.0.0 
B类: 255.255.0.0
C类: 255.255.255.0

子网中只要1是连续的,就是合理的子网掩码
e.g: 11111111.11111111.11111111.10000000 (255.255.255.128) 即把网段进行划分

### 子网掩码计算公式
网络地址: 把IP地址和子网掩码的二进制安位进行与运算
广播地址: 有效子网掩码中有几位0就把IP地址的后几位换为1
子网个数: 有效子网掩码中有几个1子网数就是2的几次方
主机个数: 有效子网掩码中有几个0,主机数就是2的几次方减2