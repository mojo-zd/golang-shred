## Linux知识体系
### 理解cpu负载和使用率
- cpu使用率 指程序在运行期间实时占用cpu的百分比
- cpu负载 指一定时间内正在使用和等待使用cpu的平均任务数，cpu的负载越高则花费的任务切换时间越长, 因为不同进程需要进行频繁切换.
提高cpu性能: 一方面增加cpu数量, 另一方面cpu的核心数也很重要

## linux ExitCode
使用 kubectl describe pod 查看异常的 pod 的状态，在容器列表里看 State 字段，其中 ExitCode 即程序退出时的状态码，正常退出时为0。如果不为0，表示异常退出，我们可以分析下原因。
### 退出状态码的区间
- 必须在 0-255 之间 
- 0 表示正常退出
- 外界中断将程序退出的时候状态码区间在 129-255，(操作系统给程序发送中断信号，比如 kill -9 是 SIGKILL，ctrl+c 是 SIGINT)
- 一般程序自身原因导致的异常退出状态区间在 1-128 (这只是一般约定，程序如果一定要用129-255的状态码也是可以的)

假如写代码指定的退出状态码时不在 0-255 之间，例如: exit(-1)，这时会自动做一个转换，最终呈现的状态码还是会在 0-255 之间。我们把状态码记为 code
- 当指定的退出时状态码为负数，那么转换公式如下:
```
256 - (|code| % 256)
```
- 当指定的退出时状态码为正数，那么转换公式如下:
```
code % 256
```

### 常见异常状态码
#### 137 
- 此状态码一般是因为 pod 中容器内存达到了它的资源限制，，一般是内存溢出(OOM)，CPU达到限制只需要不分时间片给程序就可以。因为限制资源是通过 linux 的 cgroup 实现的，所以 cgroup 会将此容器强制杀掉，类似于 kill -9。
- 还可能是宿主机本身资源不够用了(OOM)，内核会选取一些进程杀掉来释放内存
- 不管是 cgroup 限制杀掉进程还是因为节点机器本身资源不够导致进程死掉，都可以从系统日志中找到记录:
> ubuntu 的系统日志在 /var/log/syslog，centos 的系统日志在 /var/log/messages，都可以用 journalctl -k 来查看系统日志

#### 1 和 255
- 这种可能是一般错误，具体错误原因只能看容器日志，因为很多程序员写异常退出时习惯用 exit(1) 或 exit(-1)，-1 会根据转换规则转成 255

### 状态码参考
这里罗列了一些状态码的含义: https://tldp.org/LDP/abs/html/exitcodes.html